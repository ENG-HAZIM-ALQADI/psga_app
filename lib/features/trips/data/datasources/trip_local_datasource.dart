import '../models/trip_model.dart';
import '../models/location_model.dart';

/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// ๐พ TripLocalDataSource - ูุงุฌูุฉ ุงูุชุฎุฒูู ุงููุญูู ููุฑุญูุงุช (Data Layer)
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
///
/// ๐ฏ ุงููุฏู ูู ูุฐุง ุงูููู:
/// ูุฐุง ุงูููู ูุญุฏุฏ "ุงูููุงุนุฏ" ุฃู "ุงูุนูุฏ" (Interface) ูุฃู ููุงุณ ูุฑูุฏ ุงูุชุนุงูู ูุน 
/// ุชุฎุฒูู ุงูุฑุญูุงุช ุนูู ุฐุงูุฑุฉ ุงููุงุชู (Offline Storage).
/// 
/// ๐ก ููุงุฐุง ูุณุชุฎุฏู Abstract Classุ
/// ุชุฎูู ุฃู ูุฐุง ุงูููู ูู "ูุชุงููุฌ" ูุฎุจุฑ ุงููุจุฑูุฌูู ุงูุขุฎุฑูู: 
/// "ุฃู ูุงุนุฏุฉ ุจูุงูุงุช ูุญููุฉ (ูุซู Hive ุฃู SQLite) ูุฌุจ ุฃู ุชููุฑ ูุฐู ุงูุฏูุงู ุงูุซูุงููุฉ".
/// ูุฐุง ูุฌุนู ุชุจุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุณุชูุจูุงู ุณููุงู ุฌุฏุงู ุฏูู ุชุบููุฑ ุจุงูู ุงูุชุทุจูู.
///
/// ๐ ุดุฑุญ ูููุจุชุฏุฆูู:
/// - Future<void>: ุชุนูู ุฃู ูุฐู ุงูุฏุงูุฉ ุณุชุฃุฎุฐ ุจุนุถ ุงูููุช (ูุฃู ุงููุชุงุจุฉ ุนูู ุงูุฐุงูุฑุฉ ููุณุช ููุฑูุฉ).
/// - TripModel: ูู ุดูู ุงูุจูุงูุงุช ุงูุฐู ุชูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุญุชูู ุนูู ุชุนูููุงุช ุงูุชุญููู ูู JSON).

abstract class TripLocalDataSource {
  
  /// โ ุญูุธ ุฑุญูุฉ ุฌุฏูุฏุฉ (Create)
  /// ุชุณุชุฎุฏู ุนูุฏ ุถุบุท ุงููุณุชุฎุฏู ุนูู "ุงุจุฏุฃ ุงูุฑุญูุฉ" ูุชุฎุฒูู ุจูุงูุงุชูุง ุงูุฃูููุฉ.
  Future<void> saveTrip(TripModel trip);

  /// ๐ ุฌูุจ ุฑุญูุฉ ูุญุฏุฏุฉ (Read)
  /// ููุฑุฑ ููุง ุงูู ID ูุชุนูุฏ ููุง ูู ุชูุงุตูู ุชูู ุงูุฑุญูุฉ.
  Future<TripModel?> getTrip(String id);

  /// ๐ ุฌูุจ ุงูุฑุญูุฉ ุงููุดุทุฉ ุงูุขู
  /// ููู ุฌุฏุงู ููุชุฃูุฏ ุฃู ุงููุณุชุฎุฏู ูุง ูุญุงูู ุจุฏุก ุฑุญูุฉ ุซุงููุฉ ููู ูู ูููู ุงูุฃููู ุจุนุฏ.
  Future<TripModel?> getActiveTrip(String userId);

  /// ๐ ุณุฌู ุงูุฑุญูุงุช (History)
  /// ุชุนูุฏ ูุงุฆูุฉ (List) ุจุฌููุน ุงูุฑุญูุงุช ุงูุชู ูุงู ุจูุง ุงููุณุชุฎุฏู ูุนุฑุถูุง ูู ุดุงุดุฉ "ุชุงุฑูุฎ ุงูุฑุญูุงุช".
  Future<List<TripModel>> getTripHistory(String userId);

  /// โ๏ธ ุชุญุฏูุซ ุจูุงูุงุช ุฑุญูุฉ (Update)
  /// ุชุณุชุฎุฏู ูุชุบููุฑ ุญุงูุฉ ุงูุฑุญูุฉ (ูุซูุงู ูู "ูุดุทุฉ" ุฅูู "ููุชููุฉ") ุฃู ุฅุถุงูุฉ ููุงุญุธุงุช.
  Future<void> updateTrip(TripModel trip);

  /// ๐ ุญูุธ ุงููููุน ุงููุญุธู (GPS Tracking)
  /// ูุฐู ุงูุฏุงูุฉ ุชูุณุชุฏุนู ุจุงุณุชูุฑุงุฑ ูุชุณุฌูู ูู ููุทุฉ ููุฑ ุจูุง ุงููุณุชุฎุฏู ูุฑุณู "ุฎุท ุงููุณุงุฑ" ุจุฏูุฉ.
  Future<void> saveLocationToHistory(String tripId, LocationModel location);

  /// ๐งน ูุณุญ ุดุงูู (Delete All)
  /// ุชุณุชุฎุฏู ุนุงุฏุฉ ุนูุฏ ุชุณุฌูู ุงูุฎุฑูุฌ ุฃู ูุณุญ ุจูุงูุงุช ุงูุชุทุจูู ูุชูุธูู ุงูุฐุงูุฑุฉ.
  Future<void> clearAll();
}

/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// ๐งช MockTripLocalDataSource - ูุณุฎุฉ "ููููุฉ" ููุงุฎุชุจุงุฑ
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
///
/// ๐ฏ ุงููุฏู:
/// ุนูุฏูุง ูููู ูู ูุฑุญูุฉ ุงูุชุทููุฑ ููุง ูุฑูุฏ ุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุจูุงูุงุช ุญููููุฉ (Hive)ุ 
/// ูุณุชุฎุฏู ูุฐุง ุงูููุงุณ ุงูุฐู ูุฎุฒู ุงูุจูุงูุงุช ูู "ุฐุงูุฑุฉ ุงูุฑุงู" ูุคูุชุงู.
/// 
/// ๐ก ููุฒุฉ ุฑุงุฆุนุฉ ูููุจุชุฏุฆูู:
/// ููููู ุชุดุบูู ุงูุชุทุจูู ูุงุฎุชุจุงุฑ ููุฒุฉ ุงูุฑุญูุงุช ุจุงููุงูู ุฏูู ุงูุญุงุฌุฉ ูุฅุนุฏุงุฏ ุฃู ูููุงุช 
/// ุชุฎุฒูู ุญููููุฉุ ูุจูุฌุฑุฏ ุฅุบูุงู ุงูุชุทุจูู ุชููุญู ุงูุจูุงูุงุช.

class MockTripLocalDataSource implements TripLocalDataSource {
  
  /// ๐พ ูุฐุง ุงููุชุบูุฑ (Map) ูุนูู ูุซู "ุฌุฏูู" ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
  /// ุงูููุชุงุญ (Key) ูู ID ุงูุฑุญูุฉุ ูุงููููุฉ (Value) ูู ุจูุงูุงุช ุงูุฑุญูุฉ ููุณูุง.
  final Map<String, TripModel> _trips = {};
  
  /// ๐ ูุฐุง ุงููุชุบูุฑ ูุญูุธ "ููุงุท ุงูุทุฑูู" ููู ุฑุญูุฉ ุจุดูู ูููุตู.
  final Map<String, List<LocationModel>> _locationHistory = {};

  /// โ ุญูุธ ุฑุญูุฉ
  @override
  Future<void> saveTrip(TripModel trip) async {
    // ููุชุธุฑ 100 ูููู ุซุงููุฉ ููุญุงูู ุณุฑุนุฉ ููุงุนุฏ ุงูุจูุงูุงุช ุงูุญููููุฉ
    await Future.delayed(const Duration(milliseconds: 100));
    _trips[trip.id] = trip;
  }

  /// ๐ ุฌูุจ ุฑุญูุฉ
  @override
  Future<TripModel?> getTrip(String id) async {
    await Future.delayed(const Duration(milliseconds: 50));
    return _trips[id];
  }

  /// ๐ ุงูุจุญุซ ุนู ุฑุญูุฉ ูุดุทุฉ ุญุงููุงู
  @override
  Future<TripModel?> getActiveTrip(String userId) async {
    await Future.delayed(const Duration(milliseconds: 50));
    try {
      // ูุจุญุซ ุฏุงุฎู ุงูู Map ุนู ุฃูู ุฑุญูุฉ ูููููุง ุงููุณุชุฎุฏู ูุญุงูุชูุง "ูุดุทุฉ"
      return _trips.values.firstWhere(
        (trip) => trip.userId == userId && trip.isActive,
      );
    } catch (_) {
      // ุฅุฐุง ูู ูุฌุฏ ุดูุฆุงูุ ูุฑูู ุฏุงุฑุช ุฎุทุฃุ ููููู ุจุงูุฅูุณุงู ุจู ูุฅุนุงุฏุฉ null
      return null;
    }
  }

  /// ๐ ุฌูุจ ุงูุณุฌู
  @override
  Future<List<TripModel>> getTripHistory(String userId) async {
    await Future.delayed(const Duration(milliseconds: 100));
    // ูุญูู ุงูู Map ุฅูู ูุงุฆูุฉ ููููุชุฑูุง ุญุณุจ ุงููุณุชุฎุฏู
    return _trips.values
        .where((trip) => trip.userId == userId)
        .toList();
  }

  /// โ๏ธ ุชุญุฏูุซ ุฑุญูุฉ
  @override
  Future<void> updateTrip(TripModel trip) async {
    await Future.delayed(const Duration(milliseconds: 100));
    _trips[trip.id] = trip;
  }

  /// ๐ ุญูุธ ููุทุฉ GPS
  @override
  Future<void> saveLocationToHistory(String tripId, LocationModel location) async {
    await Future.delayed(const Duration(milliseconds: 50));
    // ุฅุฐุง ูุงูุช ุงูุฑุญูุฉ ููุณ ููุง ุณุฌู ุจุนุฏุ ููุดุฆ ูุงุฆูุฉ ูุงุฑุบุฉ
    _locationHistory.putIfAbsent(tripId, () => []);
    // ูุถูู ุงููููุน ุงูุฌุฏูุฏ ููุณุฌู
    _locationHistory[tripId]!.add(location);
  }

  /// ๐งน ูุณุญ ูู ุดูุก
  @override
  Future<void> clearAll() async {
    _trips.clear();
    _locationHistory.clear();
  }
}
