import 'package:dartz/dartz.dart';
import '../../../../core/errors/failures.dart';
import '../../../../core/utils/logger.dart';
import '../entities/route_entity.dart';
import '../repositories/route_repository.dart';

/// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
/// ğŸ”§ UpdateRouteUseCase - "Ù…Ø­Ø±Ø± Ø§Ù„Ø·Ø±Ù‚" (Domain Layer)
/// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
/// 
/// â“ Ù…Ø§ Ù‡ÙŠ ÙˆØ¸ÙŠÙØ© Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„ÙØŸ
/// ÙŠØ³ØªØ®Ø¯Ù… Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ±ÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø·Ø±ÙŠÙ‚ Ù‚Ø¯ÙŠÙ… (Ù…Ø«Ù„ ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ù‡ Ø£Ùˆ ÙˆØµÙÙ‡).
///
/// ğŸ’¡ Ø´Ø±Ø­ Ù„Ù„Ù…Ø¨ØªØ¯Ø¦ÙŠÙ†:
/// - copyWith: Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù‡Ù†Ø§ Ù„Ù†Ù†Ø´Ø¦ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø·Ø±ÙŠÙ‚ ÙˆÙ„ÙƒÙ† Ù…Ø¹ "ØªØ§Ø±ÙŠØ® ØªØ­Ø¯ÙŠØ«" Ø¬Ø¯ÙŠØ¯ (Ø§Ù„Ø¢Ù†).
/// - fold: Ø¯Ø§Ù„Ø© Ù†Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ù‡Ù„ ÙˆØ¬Ø¯Ù†Ø§ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù‚Ø¯ÙŠÙ…ØŸ Ø£Ù… Ø­Ø¯Ø« Ø®Ø·Ø£ØŸ).

class UpdateRouteUseCase {
  final RouteRepository repository;

  UpdateRouteUseCase(this.repository);

  /// ğŸ”¹ ØªÙ†ÙÙŠØ° Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ (Call)
  /// [route]: Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©.
  Future<Either<Failure, RouteEntity>> call(RouteEntity route) async {
    AppLogger.info('[Routes] Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø±: ${route.id}');

    // 1ï¸âƒ£ Ù†ØªØ£ÙƒØ¯ Ø£ÙˆÙ„Ø§Ù‹ Ø£Ù† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³Ø§Ø± Ù…ÙˆØ¬ÙˆØ¯ ÙØ¹Ù„Ø§Ù‹ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù….
    final existingRoute = await repository.getRoute(route.id);

    return existingRoute.fold(
      (failure) {
        AppLogger.error('[Routes] Ø®Ø·Ø£: Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ­Ø¯ÙŠØ« Ù…Ø³Ø§Ø± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø£ØµÙ„Ø§Ù‹ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…');
        return Left(failure);
      },
      
      (_) async {
        // 2ï¸âƒ£ Ù†Ø¬Ù‡Ø² Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„ØªØ­Ø¯ÙŠØ« ÙˆÙ†Ø¶Ø¹ ÙÙŠÙ‡Ø§ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒÙ€ "ØªØ§Ø±ÙŠØ® ØªØ­Ø¯ÙŠØ«".
        final updatedRoute = route.copyWith(
          updatedAt: DateTime.now(),
        );

        // 3ï¸âƒ£ Ù†Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.
        final result = await repository.updateRoute(updatedRoute);

        // 4ï¸âƒ£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†Ø¬Ø§Ø­.
        result.fold(
          (failure) => AppLogger.error('[Routes] ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'),
          (updated) => AppLogger.success('[Routes] ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ ØªØ§Ù…'),
        );

        return result;
      },
    );
  }
}
