import 'package:dartz/dartz.dart';
import '../../../../core/errors/failures.dart';
import '../../../../core/utils/logger.dart';
import '../entities/route_entity.dart';
import '../repositories/route_repository.dart';

/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// ๐๏ธ CreateRouteUseCase - "ูุฎุทุท ุงูุทุฑู ุงูุฌุฏูุฏ" (Domain Layer)
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// 
/// โ ูุง ูู ูุธููุฉ ูุฐุง ุงููููุ
/// ูุฐุง ุงูููู ูู ุงููุณุคูู ุงููุญูุฏ ุนู ุนูููุฉ "ุฅุถุงูุฉ ุทุฑูู ุฌุฏูุฏ" ููุงุฆูุฉ ุทุฑู ุงููุณุชุฎุฏู.
/// ูู ูุชุฃูุฏ ุฃู ุงูุทุฑูู ุงูุฐู ุฑุณูู ุงููุณุชุฎุฏู ููุทูู ูุตุญูุญ ูุจู ุฃู ูุฑุณูู ููุชุฎุฒูู.
///
/// ๐ก ุดุฑุญ ูููุจุชุฏุฆูู:
/// - Validation: ูู ุนูููุฉ ุงูุชุฃูุฏ ูู ุฃู ุงูุจูุงูุงุช "ุณูููุฉ". ูุซูุงู: ูู ูุณู ุงููุณุชุฎุฏู 
///   ุชุณููุฉ ุงูุทุฑููุ ูู ุงููุณุงูุฉ ุจูู ููุทุฉ ุงูุจุฏุงูุฉ ูุงูููุงูุฉ ุตูุฑุ
/// - Single Responsibility: ูุฐุง ุงูููุงุณ ููุนู ุดูุฆุงู ูุงุญุฏุงู ููุทุ ููุฐุง ูุฌุนูู ุณูู 
///   ุงูููู ูุณูู ุงูุฅุตูุงุญ ุฅุฐุง ุญุฏุซ ููู ุฎุทุฃ.

class CreateRouteUseCase {
  final RouteRepository repository;

  CreateRouteUseCase(this.repository);

  /// ๐น ุชูููุฐ ุงูุนูููุฉ (Call)
  /// [route]: ูู ูุงุฆู ูุญุชูู ุนูู ูู ุชูุงุตูู ุงููุณุงุฑ ุงูุฌุฏูุฏ (ุงูุงุณูุ ุงูููุทุ ุงูุฎ).
  Future<Either<Failure, RouteEntity>> call(RouteEntity route) async {
    AppLogger.info('[Routes] ุฌุงุฑู ูุญุงููุฉ ุฅูุดุงุก ูุณุงุฑ ุฌุฏูุฏ ุจุงุณู: ${route.name}');

    // 1๏ธโฃ ุงูุชุญูู ูู ุงูุงุณู (Validation)
    // ูุง ูุณูุญ ูููุณุชุฎุฏู ุจุญูุธ ุทุฑูู ุจุฏูู ุงุณู ูุฃู ุฐูู ุณูุฒุนุฌู ูุงุญูุงู ุนูุฏ ุงูุจุญุซ.
    if (route.name.isEmpty) {
      AppLogger.warning('[Routes] ุชูุจูู: ุงููุณุชุฎุฏู ุญุงูู ุญูุธ ูุณุงุฑ ุจุฏูู ุงุณู');
      return const Left(ValidationFailure(message: 'ูุฌุจ ุนููู ูุชุงุจุฉ ุงุณู ูููุณุงุฑ ุฃููุงู'));
    }

    // 2๏ธโฃ ููุทู ุฅุถุงูู (ูุซุงู ุชุนูููู):
    // ูุญุณุจ ุงููุณุงูุฉ ุงููุจุงุดุฑุฉ (ูุฎุท ูุณุชููู) ููุนุฑู ูู ุงููุณุงุฑ ูุณุชุญู ุงูุญูุธ ุฃู ูุง.
    final distance = route.startPoint.location.distanceTo(route.endPoint.location);
    AppLogger.info('[Routes] ุงููุณุงูุฉ ุงููุจุงุดุฑุฉ ุจูู ุงูููุทุชูู: ${(distance / 1000).toStringAsFixed(2)} ูู');

    // 3๏ธโฃ ุงูุทูุจ ูู ุงููุณุชูุฏุน (Repository) ุงูููุงู ุจุงูุญูุธ ุงููุนูู
    // ููุง ูุชุฑู ุงููููุฉ ููู Repository ููุชุนุงูู ูู ูุน ูุงุนุฏุฉ ุงูุจูุงูุงุช.
    final result = await repository.createRoute(route);

    // 4๏ธโฃ ูุชุงุจุนุฉ ุงููุชูุฌุฉ ูุชุณุฌูููุง
    result.fold(
      (failure) => AppLogger.error('[Routes] ูุดู ุฅูุดุงุก ุงููุณุงุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช: ${failure.message}'),
      (createdRoute) => AppLogger.success('[Routes] ุชู ุญูุธ ุงููุณุงุฑ ุจูุฌุงุญ ูุงูุชููุช ุงููููุฉ!'),
    );

    return result;
  }
}
