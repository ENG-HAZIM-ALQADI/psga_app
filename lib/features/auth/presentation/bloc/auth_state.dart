import 'package:equatable/equatable.dart';
import '../../domain/entities/user_entity.dart';

/// ═══════════════════════════════════════════════════════════════════════════
/// 📌 AuthState - حالات المصادقة (States)
/// ═══════════════════════════════════════════════════════════════════════════
///
/// الهدف من هذا الملف:
/// تعريف جميع الحالات الممكنة في ميزة المصادقة
/// 
/// ما هي الحالة؟
/// الحالة = حالة التطبيق الحالية (الحالة التي تعرضها الواجهة)
///
/// أمثلة:
/// - AuthLoading: جاري التحميل (عرض spinner)
/// - AuthSuccess: نجح الدخول (اذهب للصفحة الرئيسية)
/// - AuthFailure: فشل الدخول (عرض رسالة خطأ)
/// - AuthUnauthenticated: المستخدم غير مسجل (عرض Login Page)
///
/// الفرق بين Event و State:
/// Event = ما يفعله المستخدم (ضغط زر)
/// State = نتيجة الفعل (نجح أم فشل)
///
/// مثال:
/// ```
/// // المستخدم يضغط الزر (Event)
/// add(AuthLoginRequested(...))
/// 
/// // BLoC يصدر حالات بالترتيب:
/// emit(AuthLoading()) → الواجهة تعرض spinner
/// emit(AuthSuccess(user)) → الواجهة تعرض Home Page
/// 
/// // أو إذا فشل:
/// emit(AuthLoading())
/// emit(AuthFailure(message)) → الواجهة تعرض رسالة خطأ
/// ```
///
/// فائدة States:
/// - وضوح: كل حالة لها معنى واحد فقط
/// - سهولة الاختبار: نختبر أن كل Event ينتج الحالات الصحيحة
/// - تحديث الواجهة: الواجهة تستمع وتحدث نفسها عند كل State جديد

/// 🔹 الأساسية: كل States يرث من AuthState
abstract class AuthState extends Equatable {
  const AuthState();

  @override
  List<Object?> get props => [];
}

/// ═══════════════════════════════════════════════════════════════════════════
/// 🔵 AuthInitial - الحالة الأولية
/// ═══════════════════════════════════════════════════════════════════════════
///
/// متى تحدث؟
/// في البداية عند إنشاء BLoC
/// لم يحدث أي شيء بعد
///
/// ماذا تعرض الواجهة؟
/// صفحة بيضاء (فارغة)

class AuthInitial extends AuthState {
  const AuthInitial();
}

/// ═══════════════════════════════════════════════════════════════════════════
/// ⏳ AuthLoading - جاري التحميل
/// ═══════════════════════════════════════════════════════════════════════════
///
/// متى تحدث؟
/// عندما يبدأ BLoC عملية (مثل: بدء تسجيل دخول)
///
/// ماذا تعرض الواجهة؟
/// عجلة تحميل (Spinner)
/// "جاري التحميل..."

class AuthLoading extends AuthState {
  const AuthLoading();
}

/// ═══════════════════════════════════════════════════════════════════════════
/// ✅ AuthSuccess - نجحت العملية
/// ═══════════════════════════════════════════════════════════════════════════
///
/// متى تحدث؟
/// - بعد تسجيل دخول ناجح
/// - بعد إنشاء حساب ناجح
/// - بعد التحقق: المستخدم مسجل دخول
///
/// البيانات:
/// - user: بيانات المستخدم الكاملة (UserEntity)
///   - id: معرف فريد
///   - email: البريد الإلكتروني
///   - displayName: الاسم
///   - photoUrl: صورة الملف الشخصي
///
/// ماذا تعرض الواجهة؟
/// Home Page (الصفحة الرئيسية)
///
/// ملاحظة مهمة:
/// GoRouter يراقب هذه الحالة تلقائياً!
/// عندما يرى AuthSuccess → ينقل للصفحة الرئيسية

class AuthSuccess extends AuthState {
  final UserEntity user;

  const AuthSuccess({required this.user});

  @override
  List<Object?> get props => [user];
}

/// ═══════════════════════════════════════════════════════════════════════════
/// ❌ AuthFailure - فشلت العملية
/// ═══════════════════════════════════════════════════════════════════════════
///
/// متى تحدث؟
/// - البريد أو الكلمة خاطئة
/// - البريد مستخدم من قبل (عند التسجيل)
/// - خطأ من الإنترنت
///
/// البيانات:
/// - message: رسالة الخطأ (نص موضح للمستخدم)
///   مثل: "البريد أو الكلمة خاطئة"
///
/// ماذا تعرض الواجهة؟
/// - رسالة خطأ (SnackBar أو Dialog)
/// - البقاء على نفس الصفحة
/// - السماح للمستخدم بالمحاولة مرة أخرى

class AuthFailure extends AuthState {
  final String message;

  const AuthFailure({required this.message});

  @override
  List<Object?> get props => [message];
}

/// ═══════════════════════════════════════════════════════════════════════════
/// 🔒 AuthUnauthenticated - المستخدم غير مسجل
/// ═══════════════════════════════════════════════════════════════════════════
///
/// متى تحدث؟
/// - بعد تسجيل خروج ناجح
/// - عند بدء التطبيق وعدم وجود Token
/// - انتهت صلاحية Token
///
/// ماذا تعرض الواجهة؟
/// Login Page (صفحة تسجيل الدخول)
/// 
/// ملاحظة:
/// GoRouter يراقب هذه الحالة أيضاً!
/// عندما يرى AuthUnauthenticated → ينقل لـ Login Page

class AuthUnauthenticated extends AuthState {
  const AuthUnauthenticated();
}

/// ═══════════════════════════════════════════════════════════════════════════
/// 📧 AuthPasswordResetSent - تم إرسال رابط التعيين
/// ═══════════════════════════════════════════════════════════════════════════
///
/// متى تحدث؟
/// بعد أن يضغط المستخدم "نسيت كلمة المرور" بنجاح
///
/// البيانات:
/// - email: البريد الذي أُرسل إليه الرابط
///
/// ماذا تعرض الواجهة؟
/// - رسالة: "تحقق من بريدك الإلكتروني"
/// - زر: "عودة"
/// - عرض البريد المستخدم

class AuthPasswordResetSent extends AuthState {
  final String email;

  const AuthPasswordResetSent({required this.email});

  @override
  List<Object?> get props => [email];
}
