import 'package:hive/hive.dart';
import '../../features/trips/data/models/route_model.dart';

/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// ๐ฆ RouteModelAdapter - ุงููุญููู ุงูุฎุงุต ุจุชุฎุฒูู ูุงุณุชุฑุฌุงุน ุงููุณุงุฑุงุช ูู Hive
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// 
/// ๐ฏ ุงููููุน ูู Clean Architecture:
/// - ุงูุทุจูุฉ: Core Layer > Adapters
/// - ุงููุธููุฉ: ุชุญููู RouteModel ูู/ุฅูู ุตูุบุฉ ุซูุงุฆูุฉ (Binary) ูุชุฎุฒูููุง ูู Hive
/// 
/// ๐ง ูุง ูู TypeAdapter ูููุด ูุญุชุงุฌูุ
/// Hive ูู ูุงุนุฏุฉ ุจูุงูุงุช ูุญููุฉ ุณุฑูุนุฉ ุฌุฏุงู ุชุญูุธ ุงูุจูุงูุงุช ุนูู ุดูู Binary (ุฃุตูุงุฑ ููุงุญุฏุงุช).
/// ููู Dart ูุง ุชุนุฑู ููู ุชุญูู ุงููุงุฆูุงุช ุงููุนูุฏุฉ ูุซู RouteModel ุฅูู Binary.
/// ููุง ูุฌู ุฏูุฑ ุงูู Adapter: ูู "ุงููุชุฑุฌู" ุงููู ูููู ูู Hive:
/// - ููู ุชุญูุธ RouteModel (ุฏุงูุฉ write)
/// - ููู ุชูุฑุงูุง ูู ุฌุฏูุฏ (ุฏุงูุฉ read)
/// 
/// ๐ ูุซุงู ุชุดุจููู:
/// ุชุฎูู RouteModel ูู "ูุชุงุจ"ุ ู Hive ูู "ููุชุจุฉ" ุชุญูุธ ุงููุชุจ ุนูู ุฑููู ูุฑููุฉ.
/// ุงูู Adapter ูู "ุฃููู ุงูููุชุจุฉ" ุงููู ูููู ุงููุชุงุจ ูุตูุญุงุช ููุฑุชุจูุง ุนูู ุงูุฑู (write)ุ
/// ูุจุนุฏูู ูุฌูุน ุงูุตูุญุงุช ููุฑุฌุนูุง ูุชุงุจ ูุงูู ููุง ุชุทูุจูุง (read).
/// 
/// โ๏ธ ููุงุญุธุฉ ูููุฉ ูููุจุชุฏุฆูู:
/// ุงูู typeId = 1 ูู "ุฑูู ุงูุฑู" ูู Hive. ูู Adapter ูุงุฒู ูููู ูู ุฑูู ูุฑูุฏุ
/// ูุฅูุง ุฑุงุญ ูุญุตู ุชุนุงุฑุถ ููุฎุฑุจ ุงูุจูุงูุงุช! 
/// (ุชุฎูู ุฅูู ุญุทูุช ูุชุงุจูู ูุฎุชูููู ุนูู ููุณ ุงูุฑู... ุฑุงุญ ูุชุฏุงุฎููุง!)

class RouteModelAdapter extends TypeAdapter<RouteModel> {
  /// ๐ข typeId: ุฑูู ุชุนุฑูู ูุฑูุฏ ููุฐุง ุงูู Adapter ูู Hive
  /// - ูู Model ูู ุงูุชุทุจูู ูุงุฒู ูููู ูู typeId ูุฎุชูู
  /// - ุงูุฃุฑูุงู ุงููุณุชุฎุฏูุฉ ูู ุงูุชุทุจูู:
  ///   0 = UserModel
  ///   1 = RouteModel โ (ุงุญูุง ููุง!)
  ///   2 = TripModel
  ///   3 = WaypointModel
  ///   4 = LocationModel
  ///   5 = AlertModel
  ///   6 = ContactModel
  ///   7 = SyncItem
  ///   8 = AlertConfigModel
  ///   9 = DeviationModel
  @override
  final int typeId = 1;

  /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  /// ๐ read() - ูุฑุงุกุฉ RouteModel ูู ุงูุชุฎุฒูู ุงููุญูู (Hive)
  /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  /// 
  /// ๐ฏ ูุชู ุชูุณุชุฏุนู ูุฐู ุงูุฏุงูุฉุ
  /// - ุนูุฏูุง ุชุทูุจ ุงูุจูุงูุงุช ูู Hiveุ ูุซูุงู:
  ///   ```dart
  ///   final route = routeBox.get('route_123');
  ///   ```
  /// - Hive ููุฑุฃ ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ ูู ุงููุฑุตุ ุซู ูุณุชุฏุนู ูุฐู ุงูุฏุงูุฉ ูุชุญููููุง ูู RouteModel
  /// 
  /// ๐ ุทุฑููุฉ ุงูุนูู (ุฎุทูุฉ ุจุฎุทูุฉ):
  /// 1. ููุฑุฃ ุนุฏุฏ ุงูุญููู ุงููุญููุธุฉ (ูุซู ุนุฏุฏ ุงูุฃุนูุฏุฉ ูู ุฌุฏูู)
  /// 2. ููุฑุฃ ูู ุญูู ุนูู ุญุฏุฉ ููุถุนู ูู Map
  /// 3. ูุญูู ุงูู Map ุฅูู JSON
  /// 4. ูุณุชุฎุฏู RouteModel.fromJson() ูุฅูุดุงุก ุงููุงุฆู
  /// 
  /// โ๏ธ ุชูุงุตูู ุชูููุฉ:
  /// - BinaryReader ูู "ูุงุฑุฆ ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ" ูู Hive
  /// - ูู ุญูู ูู "ุฑูู ูุณูุณู" (Field Index) ูุญุฏุฏ ูููุนู
  /// - ูุณุชุฎุฏู Loop ูููุฑูุฑ ุนูู ุฌููุน ุงูุญููู ุจุฏูุงู ูู ูุชุงุจุชูุง ูุฏููุงู
  @override
  RouteModel read(BinaryReader reader) {
    /// 1๏ธโฃ ููุฑุฃ ุนุฏุฏ ุงูุญููู ุงููุญููุธุฉ
    /// readByte() ุชูุฑุฃ ุฑูู ูุงุญุฏ (ูู 0 ุฅูู 255)
    final numOfFields = reader.readByte();
    
    /// 2๏ธโฃ ููุดุฆ Map ูุงุถูุฉ ูุชุฌููุน ุฌููุน ุงูุญููู
    /// ุงูููุชุงุญ = ุฑูู ุงูุญูู (Field Index)
    /// ุงููููุฉ = ุงูุจูุงูุงุช ุงููุญููุธุฉ
    final fields = <int, dynamic>{
      /// Loop: ููุฑ ุนูู ูู ุญูู ูููุฑุฃู
      /// ูุซุงู: ุฅุฐุง ูุงู numOfFields = 14ุ ุฑุงุญ ููุฑุฃ 14 ุญูู
      for (int i = 0; i < numOfFields; i++) 
        reader.readByte(): reader.read(), // readByte() = ุฑูู ุงูุญููุ read() = ุงููููุฉ
    };

    /// 3๏ธโฃ ูุญูู ุงูู fields Map ุฅูู JSON Map
    /// ููุง ูุณุชุฎุฏู RouteModel.fromJson() ูุฅูุดุงุก ุงููุงุฆู
    /// 
    /// ๐ ุดุฑุญ ูู ุญูู ุจุงูุชูุตูู:
    return RouteModel.fromJson({
      /// Field 0: ูุนุฑูู ุงููุณุงุฑ (ID)
      /// - String ูุฑูุฏ ููู ูุณุงุฑ (ูุซู "route_abc123")
      'id': fields[0] as String,
      
      /// Field 1: ูุนุฑูู ุงููุณุชุฎุฏู ุตุงุญุจ ุงููุณุงุฑ
      /// - ูุฑุจุท ุงููุณุงุฑ ุจุตุงุญุจู (ูุซู "user_xyz789")
      'userId': fields[1] as String,
      
      /// Field 2: ุงุณู ุงููุณุงุฑ
      /// - ุงููุต ุงูุฐู ูุฑุงู ุงููุณุชุฎุฏู (ูุซู "ุงูุทุฑูู ุงูุณุฑูุน ููุฌุงูุนุฉ")
      'name': fields[2] as String,
      
      /// Field 3: ูุตู ุงููุณุงุฑ (ุงุฎุชูุงุฑู)
      /// - ูุนูููุงุช ุฅุถุงููุฉ ุนู ุงููุณุงุฑ
      /// - ูููู ุฃู ูููู null ุฅุฐุง ูู ููุชุจ ุงููุณุชุฎุฏู ูุตู
      'description': fields[3] as String?,
      
      /// Field 4: ููุทุฉ ุงูุจุฏุงูุฉ (Waypoint)
      /// - ูุญููุธุฉ ูู Mapุ ุฑุงุญ ูุญูููุง ูู Waypoint ูู fromJson
      'startPoint': fields[4],
      
      /// Field 5: ููุทุฉ ุงูููุงูุฉ (Waypoint)
      'endPoint': fields[5],
      
      /// Field 6: ุงูููุงุท ุงููุณูุทุฉ (ูุญุทุงุช ุงูุฑุงุญุฉุ ุฅูุฎ)
      /// - ูุงุฆูุฉ ูู Waypoints
      /// - ุฅุฐุง ูุงูุช nullุ ูุณุชุฎุฏู ูุงุฆูุฉ ูุงุถูุฉ []
      'waypoints': fields[6] ?? [],
      
      /// Field 7: ุงูููุช ุงููุชููุน ุจุงูุซูุงูู
      /// - ูุซุงู: 3600 ุซุงููุฉ = 1 ุณุงุนุฉ
      /// - ูุญูุธู ูู int ูุฃู Binary ุฃุณุฑุน ูู ุงูุชุนุงูู ูุน ุงูุฃุฑูุงู ุงูุตุญูุญุฉ
      'estimatedDurationSeconds': fields[7] as int,
      
      /// Field 8: ุงููุณุงูุฉ ุงููุชููุนุฉ (ุจุงููููููุชุฑุงุช)
      /// - ุฑูู ุนุดุฑู (ูุซู 45.5 ูู)
      'estimatedDistance': fields[8] as double,
      
      /// Field 9: ูู ุงููุณุงุฑ ููุถูุ
      /// - true = ูุฌูุฉ ุฐูุจูุฉ (ููุถู)
      /// - false = ุนุงุฏู
      'isFavorite': fields[9] as bool,
      
      /// Field 10: ุนุฏุฏ ูุฑุงุช ุงุณุชุฎุฏุงู ุงููุณุงุฑ
      /// - ูุฒูุฏ ูู ูุง ุงููุณุชุฎุฏู ูุจุฏุฃ ุฑุญูุฉ ุฌุฏูุฏุฉ ุนูู ูุฐุง ุงููุณุงุฑ
      'usageCount': fields[10] as int,
      
      /// Field 11: ุชุงุฑูุฎ ุฅูุดุงุก ุงููุณุงุฑ
      /// - ูุญููุธ ูู String ุจุตูุบุฉ ISO 8601
      /// - ูุซุงู: "2024-01-15T10:30:00.000Z"
      'createdAt': fields[11] as String,
      
      /// Field 12: ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ
      /// - ูุชุบูุฑ ูู ูุง ุงููุณุชุฎุฏู ูุนุฏู ุงููุณุงุฑ
      'updatedAt': fields[12] as String,
      
      /// Field 13: ููุงุท ุงูุฎุท ุนูู ุงูุฎุฑูุทุฉ (Polyline Points)
      /// - ูุฆุงุช ุงูููุงุท ุงูุตุบูุฑุฉ ุฌุฏุงู ุงูุชู ุชุฑุณู ุงูุฎุท ุงููููู ุนูู Google Maps
      /// - ูุญููุธุฉ ูู List ูู LocationModels
      /// - ุฅุฐุง ูุงูุช nullุ ูุณุชุฎุฏู ูุงุฆูุฉ ูุงุถูุฉ []
      'polylinePoints': fields[13] ?? [],
    });
  }

  /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  /// ๐พ write() - ุญูุธ RouteModel ูู ุงูุชุฎุฒูู ุงููุญูู (Hive)
  /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  /// 
  /// ๐ฏ ูุชู ุชูุณุชุฏุนู ูุฐู ุงูุฏุงูุฉุ
  /// - ุนูุฏูุง ูุญูุธ ูุณุงุฑ ุฌุฏูุฏ ูู Hive:
  ///   ```dart
  ///   await routeBox.put('route_123', routeModel);
  ///   ```
  /// - ุฃู ุนูุฏูุง ูุญุฏูุซ ูุณุงุฑ ููุฌูุฏ
  /// 
  /// ๐ ุทุฑููุฉ ุงูุนูู:
  /// 1. ูุญูู RouteModel ุฅูู JSON Map (ุจุงุณุชุฎุฏุงู toJson)
  /// 2. ููุชุจ ุนุฏุฏ ุงูุญููู (14 ูู ุญุงูุชูุง)
  /// 3. ููุชุจ ูู ุญูู ุนูู ุญุฏุฉ ุจููุณ ุงูุชุฑุชูุจ
  /// 
  /// โ๏ธ ุชูุจูู ููู ุฌุฏุงู:
  /// - ุชุฑุชูุจ ูุชุงุจุฉ ุงูุญููู ูู write() ูุงุฒู ูุทุงุจู ุชุฑุชูุจ ูุฑุงุกุชูุง ูู read()
  /// - ูู ุงุฎุชูู ุงูุชุฑุชูุจุ ุฑุงุญ ุชููุฑุฃ ุงูุจูุงูุงุช ุบูุท ููููุงุฑ ุงูุชุทุจูู!
  /// 
  /// ๐ ูุซุงู ุชูุถูุญู:
  /// ูู ูุชุจูุง 'name' ูู Field 0 ููุฑููุงู ูู Field 2ุ ุฑุงุญ ูุฌูุจ ูููุฉ ุฎุงุทุฆุฉ
  @override
  void write(BinaryWriter writer, RouteModel obj) {
    /// ุฃููุงู: ูุญูู ุงูู RouteModel ุฅูู JSON
    /// ูุญุชุงุฌู ูุจุนุถ ุงูุญููู ุงููุนูุฏุฉ (ูุซู startPointุ endPoint)
    final json = obj.toJson();

    /// ูุจุฏุฃ ุงููุชุงุจุฉ!
    writer
      /// 1๏ธโฃ ููุชุจ ุนุฏุฏ ุงูุญููู (14 ุญูู)
      /// ูุงุฒู ูููู ููุณ ุงูุนุฏุฏ ูู read()
      ..writeByte(14)
      
      /// 2๏ธโฃ Field 0: ูุนุฑูู ุงููุณุงุฑ
      /// ุงูู (..) ุชุณูู "cascade operator" - ุชุนูู "ุงุณุชูุฑ ุจุงููุชุงุจุฉ ุนูู ููุณ ุงูู writer"
      /// ุจุฏูููุงุ ูุงุฒู ููุชุจ writer.writeByte() ูู ูุฑุฉ
      ..writeByte(0)        // ุฑูู ุงูุญูู
      ..write(obj.id)       // ุงููููุฉ
      
      /// 3๏ธโฃ Field 1: ูุนุฑูู ุงููุณุชุฎุฏู
      ..writeByte(1)
      ..write(obj.userId)
      
      /// 4๏ธโฃ Field 2: ุงุณู ุงููุณุงุฑ
      ..writeByte(2)
      ..write(obj.name)
      
      /// 5๏ธโฃ Field 3: ุงููุตู (ุงุฎุชูุงุฑู)
      /// ูููู ูููู nullุ Hive ูุชุนุงูู ูุนูุง ุชููุงุฆูุงู
      ..writeByte(3)
      ..write(obj.description)
      
      /// 6๏ธโฃ Field 4: ููุทุฉ ุงูุจุฏุงูุฉ
      /// ูุญูุธูุง ูู JSON Map ูุฃููุง ูุงุฆู ูุนูุฏ (Waypoint)
      /// ูู read() ุฑุงุญ ูุญูููุง ูู ุฌุฏูุฏ ูู WaypointModel
      ..writeByte(4)
      ..write(json['startPoint'])
      
      /// 7๏ธโฃ Field 5: ููุทุฉ ุงูููุงูุฉ
      ..writeByte(5)
      ..write(json['endPoint'])
      
      /// 8๏ธโฃ Field 6: ุงูููุงุท ุงููุณูุทุฉ (ูุงุฆูุฉ)
      /// ูุญููุธุฉ ูู List of Maps
      ..writeByte(6)
      ..write(json['waypoints'])
      
      /// 9๏ธโฃ Field 7: ุงูููุช ุงููุชููุน
      /// ูุญูู Duration ุฅูู ุซูุงูู (int) ูุฃู Binary ุฃุณุฑุน ูุน ุงูุฃุฑูุงู ุงูุตุญูุญุฉ
      /// ูุซุงู: Duration(hours: 1, minutes: 30) โ 5400 ุซุงููุฉ
      ..writeByte(7)
      ..write(obj.estimatedDuration.inSeconds)
      
      /// ๐ Field 8: ุงููุณุงูุฉ ุงููุชููุนุฉ
      ..writeByte(8)
      ..write(obj.estimatedDistance)
      
      /// 1๏ธโฃ1๏ธโฃ Field 9: ูู ููุถูุ
      ..writeByte(9)
      ..write(obj.isFavorite)
      
      /// 1๏ธโฃ2๏ธโฃ Field 10: ุนุฏุฏ ูุฑุงุช ุงูุงุณุชุฎุฏุงู
      ..writeByte(10)
      ..write(obj.usageCount)
      
      /// 1๏ธโฃ3๏ธโฃ Field 11: ุชุงุฑูุฎ ุงูุฅูุดุงุก
      /// ูุญูู DateTime ุฅูู String ุจุตูุบุฉ ISO 8601
      /// ูุซุงู: DateTime.now() โ "2024-01-15T10:30:00.000Z"
      /// ููุด Stringุ ูุฃู Hive ูุง ุชุฏุนู DateTime ูุจุงุดุฑุฉ
      ..writeByte(11)
      ..write(obj.createdAt.toIso8601String())
      
      /// 1๏ธโฃ4๏ธโฃ Field 12: ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ
      ..writeByte(12)
      ..write(obj.updatedAt.toIso8601String())
      
      /// 1๏ธโฃ5๏ธโฃ Field 13: ููุงุท ุงูุฎุท ุนูู ุงูุฎุฑูุทุฉ
      /// ูุงุฆูุฉ ูู LocationModels ูุญููุฉ ูู JSON
      /// ูููู ุฃู ุชุญุชูู ุนูู ูุฆุงุช ุงูููุงุท!
      ..writeByte(13)
      ..write(json['polylinePoints']);
  }
}

/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// ๐ ุฎูุงุตุฉ ูููุจุชุฏุฆูู:
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// 
/// โ ูุง ุชุนูููุงู:
/// 1. ุงูู Adapter ูู "ุฌุณุฑ" ุจูู ูุงุฆูุงุช Dart ูุจูู Hive Database
/// 2. read() ุชุญูู ุงูุจูุงูุงุช ุงูุซูุงุฆูุฉ โ RouteModel
/// 3. write() ุชุญูู RouteModel โ ุจูุงูุงุช ุซูุงุฆูุฉ
/// 4. ูุงุฒู ูุญุงูุธ ุนูู ููุณ ุชุฑุชูุจ ุงูุญููู ูู read() ู write()
/// 5. typeId ูุงุฒู ูููู ูุฑูุฏ ููู Adapter
/// 
/// ๐ก ูุตูุญุฉ:
/// ูู ุฃุถูุช ุญูู ุฌุฏูุฏ ูู RouteModelุ ูุง ุชูุณู:
/// - ุชุถููู ูู read() ู write() ุจููุณ ุงูุชุฑุชูุจ
/// - ุชุฒูุฏ ุนุฏุฏ ุงูุญููู (ูู 14 ุฅูู 15 ูุซูุงู)
/// - ุชุฎุชุจุฑ ุฌูุฏุงู ูุจู ุงููุดุฑ!
/// 
/// ๐ซ ุฃุฎุทุงุก ุดุงุฆุนุฉ ูุฌุจ ุชุฌูุจูุง:
/// 1. ุชุบููุฑ typeId ุจุนุฏ ูุดุฑ ุงูุชุทุจูู (ูุฎุฑุจ ุงูุจูุงูุงุช ุงููุญููุธุฉ!)
/// 2. ุงุฎุชูุงู ุชุฑุชูุจ ุงูุญููู ุจูู read ู write
/// 3. ูุณูุงู ุชุญุฏูุซ ุนุฏุฏ ุงูุญููู ุจุนุฏ ุฅุถุงูุฉ ุญูู ุฌุฏูุฏ
/// 4. ุงุณุชุฎุฏุงู ููุณ typeId ูู Adapters ูุฎุชููุฉ
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
