import 'package:hive/hive.dart';
import '../../features/trips/data/models/location_model.dart';

/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// ๐ LocationModelAdapter - ุงููุญููู ุงูุฎุงุต ุจุชุฎุฒูู ูุงุณุชุฑุฌุงุน ุงูููุงูุน ุงูุฌุบุฑุงููุฉ
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// 
/// ๐ฏ ุงููููุน ูู Clean Architecture:
/// - ุงูุทุจูุฉ: Core Layer > Adapters
/// - ุงููุธููุฉ: ุชุญููู LocationModel (ููุทุฉ GPS ูุงุญุฏุฉ) ูู/ุฅูู Binary
/// 
/// ๐ ูุง ูู LocationModelุ
/// LocationModel ููุซู "ููุทุฉ ูุงุญุฏุฉ" ุนูู ุงูุฎุฑูุทุฉุ ูุญุชูู ุนูู:
/// - latitude: ุฎุท ุงูุนุฑุถ (ุงููููุน ุงูุดูุงูู/ุงูุฌููุจู)
/// - longitude: ุฎุท ุงูุทูู (ุงููููุน ุงูุดุฑูู/ุงูุบุฑุจู)
/// - altitude: ุงูุงุฑุชูุงุน ุนู ุณุทุญ ุงูุจุญุฑ (ุงุฎุชูุงุฑู)
/// - accuracy: ุฏูุฉ ุงููุฑุงุกุฉ ุจุงูุฃูุชุงุฑ (ุงุฎุชูุงุฑู)
/// - timestamp: ูุชู ุชู ุฑุตุฏ ูุฐุง ุงููููุนุ
/// - address: ุงูุนููุงู ุงููุตู (ุงุฎุชูุงุฑู)
/// 
/// ๐ก ูุซุงู ุชูุถูุญู:
/// ุชุฎูู ุฃูู ุชุณุชุฎุฏู Google Maps ูุชุถุบุท ุนูู "ูููุนู ุงูุญุงูู"ุ
/// ุงูููุจุงูู ูุนุทูู:
/// - latitude: 24.7136 (ุงูุฑูุงุถ ูู ุงูููููุฉ)
/// - longitude: 46.6753
/// - accuracy: ยฑ 10 ูุชุฑ (ูุนูู ูููู ุชููู ุฃู ููุงู ูู ุฏุงุฆุฑุฉ ูุทุฑูุง 10 ูุชุฑ)
/// - timestamp: 2024-01-15 10:30:00
/// - address: "ุญู ุงููุฎููุ ุงูุฑูุงุถ"
/// 
/// ๐ข typeId = 4:
/// - ูุฐุง ุงูุฑูู ุงููุฑูุฏ ูููุฒ LocationModel ุนู ุจุงูู Models
/// - ูุง ูุฌูุฒ ุงุณุชุฎุฏุงูู ูู Model ุขุฎุฑ ุฃุจุฏุงู!
/// 
/// ๐ฏ ุงุณุชุฎุฏุงูุงุช LocationModel ูู ุงูุชุทุจูู:
/// 1. ุชุฎุฒูู ูููุน ุงููุณุชุฎุฏู ุงูุญุงูู ุฃุซูุงุก ุงูุฑุญูุฉ
/// 2. ุญูุธ ุณุฌู ูุงูู ูุชุญุฑูุงุช ุงููุณุชุฎุฏู (Location History)
/// 3. ุชุญุฏูุฏ ููุงุท ุงูุจุฏุงูุฉ ูุงูููุงูุฉ ูู Routes ู Trips
/// 4. ุฑุตุฏ ุงูุงูุญุฑุงูุงุช ุนู ุงููุณุงุฑ
/// 5. ุฅุฑุณุงู ุงููููุน ูู ุญุงูุงุช ุงูุทูุงุฑุฆ (SOS)
/// 
/// โ๏ธ ููุงุญุธุฉ ูููุฉ ุนู ุงูุฃุฏุงุก:
/// Location ูู ุฃูุซุฑ Model ูุชู ุญูุธู ูู ุงูุชุทุจูู!
/// - ูุชู ุชุณุฌูู ูููุน ูู 5-10 ุซูุงูู ุฃุซูุงุก ุงูุฑุญูุฉ
/// - ุฑุญูุฉ ููุฏุฉ ุณุงุนุฉ = ุญูุงูู 360-720 ููุทุฉ GPS!
/// - ูุฐุง ูุฌุจ ุฃู ูููู ุงูู Adapter ุณุฑูุน ุฌุฏุงู ูู ุงููุฑุงุกุฉ ูุงููุชุงุจุฉ

class LocationModelAdapter extends TypeAdapter<LocationModel> {
  /// ๐ข typeId: ุฑูู ุงูุชุนุฑูู ุงููุฑูุฏ
  /// - 0 = UserModel
  /// - 1 = RouteModel
  /// - 2 = TripModel
  /// - 3 = WaypointModel
  /// - 4 = LocationModel โ (ุงุญูุง ููุง!)
  /// - 5-9 = Models ุฃุฎุฑู
  @override
  final int typeId = 4;

  /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  /// ๐ read() - ูุฑุงุกุฉ LocationModel ูู Hive
  /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  /// 
  /// ๐ฏ ูุชู ุชูุณุชุฏุนูุ
  /// - ุนูุฏ ูุฑุงุกุฉ ูููุน ูุญููุธ
  /// - ุนูุฏ ุนุฑุถ ุณุฌู ุงูุฑุญูุงุช ุงูุณุงุจูุฉ
  /// - ุนูุฏ ุฑุณู ุฎุท ุงูุฑุญูุฉ ุนูู ุงูุฎุฑูุทุฉ
  /// - ุนูุฏ ุงุณุชุฑุฌุงุน ูููุน ุจุฏุงูุฉ ุฃู ููุงูุฉ ูุณุงุฑ
  /// 
  /// ๐ ุงูุฎุทูุงุช:
  /// 1. ูุฑุงุกุฉ ุนุฏุฏ ุงูุญููู (6 ุญููู)
  /// 2. ูุฑุงุกุฉ ูู ุญูู ุนูู ุญุฏุฉ
  /// 3. ุฅูุดุงุก LocationModel ูู ุงูุจูุงูุงุช
  /// 
  /// ๐ก ููุงุญุธุฉ ูููุจุชุฏุฆูู:
  /// LocationModel ูู ุฃุจุณุท Model ูู ุงูุชุทุจููุ ูุญุชูู ุนูู 6 ุญููู ููุท
  /// ูููู ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู! (ุขูุงู ุงููุฑุงุช ูู ุฑุญูุฉ ูุงุญุฏุฉ)
  @override
  LocationModel read(BinaryReader reader) {
    /// 1๏ธโฃ ููุฑุฃ ุนุฏุฏ ุงูุญููู (6 ุญููู)
    final numOfFields = reader.readByte();
    
    /// 2๏ธโฃ ูุฌูุน ุงูุจูุงูุงุช ูู Map
    final fields = <int, dynamic>{
      for (int i = 0; i < numOfFields; i++) reader.readByte(): reader.read(),
    };

    /// 3๏ธโฃ ูููุดุฆ LocationModel ูู ุงูุจูุงูุงุช ุงูููุฑูุกุฉ
    /// 
    /// ๐ ุดุฑุญ ูู ุญูู:
    return LocationModel(
      /// Field 0: ุฎุท ุงูุนุฑุถ (Latitude)
      /// - ุฑูู ุนุดุฑู ูู -90 ุฅูู +90
      /// - ุงูุฃุฑูุงู ุงูููุฌุจุฉ = ุดูุงู ุฎุท ุงูุงุณุชูุงุก
      /// - ุงูุฃุฑูุงู ุงูุณุงูุจุฉ = ุฌููุจ ุฎุท ุงูุงุณุชูุงุก
      /// - ูุซุงู: 24.7136 (ูุฏููุฉ ุงูุฑูุงุถ)
      latitude: fields[0] as double,
      
      /// Field 1: ุฎุท ุงูุทูู (Longitude)
      /// - ุฑูู ุนุดุฑู ูู -180 ุฅูู +180
      /// - ุงูุฃุฑูุงู ุงูููุฌุจุฉ = ุดุฑู ุฎุท ุบุฑููุชุด
      /// - ุงูุฃุฑูุงู ุงูุณุงูุจุฉ = ุบุฑุจ ุฎุท ุบุฑููุชุด
      /// - ูุซุงู: 46.6753 (ูุฏููุฉ ุงูุฑูุงุถ)
      longitude: fields[1] as double,
      
      /// Field 2: ุงูุงุฑุชูุงุน (Altitude) - ุงุฎุชูุงุฑู
      /// - ูู ูุชุฑ ุฃูุช ููู ุณุทุญ ุงูุจุญุฑุ
      /// - ูุซุงู: 612 ูุชุฑ (ุงุฑุชูุงุน ุงูุฑูุงุถ)
      /// - ูููู ุฃู ูููู null ุฅุฐุง ูู ูููุฑู GPS
      /// - ูููุฏ ูู ุงูููุงุทู ุงูุฌุจููุฉ ูุญุณุงุจ ุงูุตุนูุฏ/ุงููุจูุท
      altitude: fields[2] as double?,
      
      /// Field 3: ุฏูุฉ ุงููุฑุงุกุฉ (Accuracy) - ุงุฎุชูุงุฑู
      /// - ูู ูุชุฑ "ูุงูุด ุงูุฎุทุฃ" ูู ุงููุฑุงุกุฉุ
      /// - ูุซุงู: 10.0 = ุงููููุน ุงููุนูู ูู ุฏุงุฆุฑุฉ ูุทุฑูุง ยฑ 10 ูุชุฑ
      /// - GPS ูู ุงูุฎุงุฑุฌ: ุนุงุฏุฉ 5-20 ูุชุฑ
      /// - GPS ุฏุงุฎู ุงููุจุงูู: ูุฏ ูุตู ูู 100+ ูุชุฑ
      /// - ูููู ุฃู ูููู null ุฅุฐุง ูู ูููุฑู GPS
      accuracy: fields[3] as double?,
      
      /// Field 4: ุงูููุช (Timestamp)
      /// - ูุชู ุชู ุฑุตุฏ ูุฐุง ุงููููุนุ
      /// - ูุญููุธ ูู String ุจุตูุบุฉ ISO 8601
      /// - ูุซุงู: "2024-01-15T10:30:00.000Z"
      /// - ูุญููู ูู String โ DateTime
      /// 
      /// ๐ก ููุงุฐุง ูุญูุธู ูู Stringุ
      /// Hive ูุง ุชุฏุนู DateTime ูุจุงุดุฑุฉุ ูุฐุง ูุญููู ูู String ุฃููุงู
      timestamp: DateTime.parse(fields[4] as String),
      
      /// Field 5: ุงูุนููุงู ุงููุตู (Address) - ุงุฎุชูุงุฑู
      /// - ุงูุงุณู "ุงูุจุดุฑู" ูููููุน
      /// - ูุซุงู: "ุดุงุฑุน ุงูุนููุงุ ุงูุฑูุงุถุ ุงูุณุนูุฏูุฉ"
      /// - ูุชู ุฌูุจู ูู ุฎุฏูุฉ Geocoding (ูุซู Google Maps API)
      /// - ููุณ ูู LocationModel ูุญุชูู ุนูู ุนููุงู (ูุชูููุฑ ุงูุฃุฏุงุก)
      /// - ุนุงุฏุฉ ูุฌูุจู ููุท ููููุงูุน ุงููููุฉ (ุจุฏุงูุฉุ ููุงูุฉุ ุงูุญุฑุงู)
      address: fields[5] as String?,
    );
  }

  /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  /// ๐พ write() - ุญูุธ LocationModel ูู Hive
  /// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  /// 
  /// ๐ฏ ูุชู ุชูุณุชุฏุนูุ
  /// - ูู 5-10 ุซูุงูู ุฃุซูุงุก ุงูุฑุญูุฉ! (ุฃูุซุฑ ุฏุงูุฉ ุชูุณุชุฏุนู ูู ุงูุชุทุจูู)
  /// - ุนูุฏ ุญูุธ ูููุน ุงูุจุฏุงูุฉ/ุงูููุงูุฉ ููุณุงุฑ ุฌุฏูุฏ
  /// - ุนูุฏ ุฑุตุฏ ุงูุญุฑุงู ุนู ุงููุณุงุฑ
  /// - ุนูุฏ ุฅุฑุณุงู ุฅุดุนุงุฑ ุทูุงุฑุฆ ูุน ุงููููุน
  /// 
  /// โก ูุตูุญุฉ ููุฃุฏุงุก:
  /// ุจูุง ุฃู ูุฐู ุงูุฏุงูุฉ ุชูุณุชุฏุนู ูุซูุฑุงู ุฌุฏุงูุ ูุฌุจ ุฃู ุชููู:
  /// 1. ุณุฑูุนุฉ ุฌุฏุงู (ุจุฏูู ุนูููุงุช ูุนูุฏุฉ)
  /// 2. ุฎูููุฉ ุนูู ุงูุฐุงูุฑุฉ
  /// 3. ูุง ุชุญุชูู ุนูู ุดููุฑุงุช ุบูุฑ ุถุฑูุฑูุฉ
  /// 
  /// ๐ ุงูุฎุทูุงุช:
  /// 1. ูุชุงุจุฉ ุนุฏุฏ ุงูุญููู (6)
  /// 2. ูุชุงุจุฉ ูู ุญูู ุจููุณ ุชุฑุชูุจ read()
  @override
  void write(BinaryWriter writer, LocationModel obj) {
    writer
      /// 1๏ธโฃ ููุชุจ ุนุฏุฏ ุงูุญููู (6 ุญููู)
      ..writeByte(6)
      
      /// 2๏ธโฃ Field 0: ุฎุท ุงูุนุฑุถ
      /// ุฑูู ุนุดุฑู (double)
      ..writeByte(0)
      ..write(obj.latitude)
      
      /// 3๏ธโฃ Field 1: ุฎุท ุงูุทูู
      ..writeByte(1)
      ..write(obj.longitude)
      
      /// 4๏ธโฃ Field 2: ุงูุงุฑุชูุงุน (ุงุฎุชูุงุฑู)
      /// ุฅุฐุง ูุงู nullุ Hive ุชุญูุธู ูู null ุชููุงุฆูุงู
      ..writeByte(2)
      ..write(obj.altitude)
      
      /// 5๏ธโฃ Field 3: ุฏูุฉ ุงููุฑุงุกุฉ (ุงุฎุชูุงุฑู)
      ..writeByte(3)
      ..write(obj.accuracy)
      
      /// 6๏ธโฃ Field 4: ุงูููุช
      /// ูุญูู DateTime ุฅูู String ุจุตูุบุฉ ISO 8601
      /// 
      /// ๐ก ูุซุงู ุงูุชุญููู:
      /// DateTime(2024, 1, 15, 10, 30)
      /// โ
      /// "2024-01-15T10:30:00.000Z"
      /// 
      /// ูุงุฆุฏุฉ ISO 8601:
      /// - ุตูุบุฉ ุนุงูููุฉ ููุญุฏุฉ
      /// - ุชุญุชูู ุนูู ุงูููุทูุฉ ุงูุฒูููุฉ (Z = UTC)
      /// - ุณูู ุชุญููููุง ูู/ุฅูู DateTime
      ..writeByte(4)
      ..write(obj.timestamp.toIso8601String())
      
      /// 7๏ธโฃ Field 5: ุงูุนููุงู (ุงุฎุชูุงุฑู)
      ..writeByte(5)
      ..write(obj.address);
  }
}

/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// ๐ ูุนูููุงุช ุฅุถุงููุฉ ูููุจุชุฏุฆูู:
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
/// 
/// ๐ ููู ูุนูู GPSุ
/// GPS (Global Positioning System) ูู ูุธุงู ูู ุงูุฃููุงุฑ ุงูุตูุงุนูุฉ ูู ุงููุถุงุก.
/// ููุจุงููู ูุณุชูุจู ุฅุดุงุฑุงุช ูู 4 ุฃููุงุฑ ุนูู ุงูุฃููุ ููุญุณุจ ูููุนู ุจูุงุกู ุนูู:
/// - ุงูููุช ุงูุฐู ุงุณุชุบุฑูุชู ุงูุฅุดุงุฑุฉ ูููุตูู
/// - ูููุน ุงูุฃููุงุฑ ูู ุงููุถุงุก
/// 
/// ๐ฏ ุนูุงูู ุชุคุซุฑ ุนูู ุฏูุฉ GPS:
/// 1. ุนุฏุฏ ุงูุฃููุงุฑ ุงููุฑุฆูุฉ (4+ ุฃูุถู)
/// 2. ุงูุทูุณ (ุงูุบููู ุชููู ุงูุฏูุฉ)
/// 3. ุงููุจุงูู (ุชุณุจุจ "ุงูุนูุงุณ" ุงูุฅุดุงุฑุฉ)
/// 4. ุงูุณุฑุนุฉ (GPS ุฃุฏู ุนูุฏ ุงูุณุฑุนุงุช ุงูุจุทูุฆุฉ)
/// 
/// ๐ ุญุฌู ุงูุจูุงูุงุช:
/// - LocationModel ูุงุญุฏ โ 50-80 ุจุงูุช ูู Hive
/// - ุฑุญูุฉ ููุฏุฉ ุณุงุนุฉ (360 ููุทุฉ) โ 18-29 ููููุจุงูุช
/// - 100 ุฑุญูุฉ โ 1.8-2.9 ููุฌุงุจุงูุช
/// - โ ุญุฌู ูุนููู ุฌุฏุงู! Hive ููุคุฉ ูู ุงูุถุบุท
/// 
/// ๐ก ูุตุงุฆุญ ููุชุนุงูู ูุน LocationModel:
/// 
/// 1๏ธโฃ ูุง ุชุญูุธ ูู ููุทุฉ GPS:
///    โ ุฎุทุฃ: ุญูุธ ูู ุซุงููุฉ (3600 ููุทุฉ ูู ุงูุณุงุนุฉ!)
///    โ ุตุญูุญ: ุญูุธ ูู 5-10 ุซูุงูู (360-720 ููุทุฉ)
/// 
/// 2๏ธโฃ ุงุณุชุฎุฏู Accuracy ููุชุตููุฉ:
///    ```dart
///    if (location.accuracy != null && location.accuracy! < 50) {
///      // ููุท ุงุญูุธ ุงูููุงูุน ุงูุฏูููุฉ (ุฃูู ูู 50 ูุชุฑ)
///      saveLocation(location);
///    }
///    ```
/// 
/// 3๏ธโฃ ุงุญุฐู ุงูููุงูุน ุงููุฏููุฉ:
///    ```dart
///    // ุงุญุฐู ุงูุฑุญูุงุช ุงูุฃูุฏู ูู 6 ุฃุดูุฑ
///    final sixMonthsAgo = DateTime.now().subtract(Duration(days: 180));
///    trips.removeWhere((trip) => trip.startTime.isBefore(sixMonthsAgo));
///    ```
/// 
/// 4๏ธโฃ ุฌูุจ Address ุจุฐูุงุก:
///    โ ุฎุทุฃ: ุฌูุจ Address ููู ููุทุฉ GPS (ุจุทูุก + ูููู!)
///    โ ุตุญูุญ: ููุท ููููุงูุน ุงููููุฉ (ุจุฏุงูุฉุ ููุงูุฉุ ุงูุญุฑุงูุงุช)
/// 
/// ๐ซ ุฃุฎุทุงุก ุดุงุฆุนุฉ:
/// 1. ูุณูุงู ุงูุชุญูู ูู ุงูุฃุฐููุงุช ูุจู ูุฑุงุกุฉ GPS
/// 2. ูุฑุงุกุฉ GPS ุจุดูู ููุซู (ูุณุชูุฒู ุงูุจุทุงุฑูุฉ!)
/// 3. ุนุฏู ูุนุงูุฌุฉ ุญุงูุฉ GPS ุบูุฑ ูุชููุฑ (ูู ุงูุฃูุงูู ุงููุบููุฉ)
/// 4. ุญูุธ ุงูููุงูุน ุบูุฑ ุงูุฏูููุฉ (accuracy > 100 ูุชุฑ)
/// 
/// โ ุฃูุถู ุงูููุงุฑุณุงุช:
/// ```dart
/// // ูุซุงู: ุญูุธ ูููุน ุจุดูู ุฐูู
/// if (location.accuracy != null && location.accuracy! < 50) {
///   // ุงููููุน ุฏูููุ ุงุญูุธู
///   await tripBox.put(trip.id, updatedTrip);
/// } else {
///   // ุงููููุน ุบูุฑ ุฏูููุ ุชุฌุงููู
///   print('GPS accuracy is poor: ${location.accuracy}m');
/// }
/// ```
/// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
